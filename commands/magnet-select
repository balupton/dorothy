#!/usr/bin/env bash
source "$DOROTHY/sources/bash.bash"

function magnet-select() (
	# prepare
	search="$1"

	# fetch
	echo-purple "searching" >/dev/tty
	mapfile -t results < <(magnet-search "$search")
	if test "${#results[@]}" -eq 0; then
		return 1
	fi

	# select
	# trunk-ignore(shellcheck/SC2016)
	local option_visual='$(echo-magnet-hash "$value")    $label'
	choose-option \
		--question="Which magnet for $search?" \
		--label=first \
		--visual="$option_visual" \
		-- "${results[@]}"
)

# fire if invoked standalone
if test "$0" = "${BASH_SOURCE[0]}"; then
	magnet-select "$@"
fi
