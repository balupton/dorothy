#!/usr/bin/env python
# https://github.com/elsbrock/twitblock/blob/be703a2fb31a372b83ab78e6d3fc24a91ef2f134/extract.py

# 1. go here and get your pdf
# https://twitter.com/settings/your_twitter_data/audiences
# 2. run this:
# twitter-advertisers twitter_advertiser_list.pdf
# 3. if you wish to block them:
# twitter-advertisers twitter_advertiser_list.pdf > advertisers.csv
# twitter-block advertisers.csv

import re
import argparse
import PyPDF2

def run():
    parser = argparse.ArgumentParser(description='Extracts usernames from the Twitter '
                                     + 'advertiser list.')
    parser.add_argument('inputfile', type=str, help='Advertiser List PDF',
                        default='twitter_advertiser_list.pdf')
    args = parser.parse_args()

    with open(args.inputfile, 'rb') as pdf_file:
        pdf_reader = PyPDF2.PdfFileReader(pdf_file)
        num_pages = pdf_reader.getNumPages()

        for pages in range(num_pages):
            user_page = pdf_reader.getPage(pages).extractText()
            for username in re.findall(r'(@[^@]+)', user_page):
                print(username.replace('@', ''))

if __name__ == '__main__':
    run()